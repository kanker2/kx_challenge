{"cells":[{"kind":2,"value":"vitals: `time xasc (\"PIE\";1#\",\")0:`:vitals.csv;\n\n.pq:use`kx.pq;\nt:.pq.pq`:weather.parquet;\nweather: `time xasc select from t;\n\nclosest: aj[`time; vitals; weather];\n\\l pykx.q","languageId":"q","outputs":[{"items":[{"data":"","mime":"text/plain"}]}]},{"kind":2,"value":"ans1: first[0!desc select count i by sensorId from closest]`sensorId;\nans2: count select from closest where heartRate > 100, temperatureF>77f;\nans3: first[0!desc select count i by hour:60 xbar time.minute from select from closest where heartRate > 100, temperatureF>77f]`hour;\nshow (ans1; ans2; ans3);","languageId":"q","outputs":[{"items":[{"data":"28\r\n10\r\n13:00\r\n","mime":"text/plain"}]}]},{"kind":2,"value":"import pykx as kx\nimport matplotlib.pyplot as plt\nclosest = kx.q(\"closest\").pd()\nclosest['condition'] = (closest.heartRate>100) & (closest.temperatureF>77)\ncolors = closest['condition'].map({True: 'red', False: 'blue'})\n\n_, ax = plt.subplots(1, 1)\nclosest.plot(\n    x='heartRate', \n    y='temperatureF', \n    kind='scatter', \n    c=colors,\n    ax=ax, \n    alpha=0.5, \n    title='Heart Rate vs. Ambient Temperature'\n)\n\nimport io, base64\nbuf = io.BytesIO()\nplt.savefig(buf, format='png')\nbuf.seek(0)\n\nimg_base64 = base64.b64encode(buf.read()).decode('utf-8')\n\nvisualization=f'<img src=\"data:image/png;base64,{img_base64}\" />'\n\nwith open('visualization.html','w') as f:\n  f.write(visualization)","languageId":"python","outputs":[{"items":[{"data":"","mime":"text/plain"}]}]}]}